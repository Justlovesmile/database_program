<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="shortcut icon" href="/static/img/logo.png">
        <script type="text/javascript" src="/static/js/jquery-3.4.1.js"></script>
        <link rel="stylesheet" href="/static/css/base.css">
        <script type="text/javascript" src="/static/js/check_session.js"></script>
        <title>å¿«é€Ÿæœç´¢</title>
</head>

<body>
        <div class='header'>
                <div class="menu">
                        <div>
                                <ul class="menubar" id="left_nav">
                                        <li class="menu-value"><a class="navbar_img" style="font-weight:bold" href="/">
                                                        <img src="/static/img/bbs.png" class="navbar_img"></a>
                                        <li>
                                        <li class=""><a href="/"><span class="glyphicon glyphicon-home"></span> é¦–é¡µ</a>
                                        </li>
                                        <li class=""><a href="/newpost/"><span class="glyphicon glyphicon-time"></span>
                                                        æœ€æ–°</a></li>
                                        <li class=""><a href="/search/"><span class="glyphicon glyphicon-search"></span>
                                                        æœç´¢</a></li>
                                        <li class=""><a href="/introduce/"><span
                                                                class="glyphicon glyphicon-info-sign"></span> è¯´æ˜</a>
                                        </li>
                                </ul>
                                <ul class="menubar_right" id="right_nav">
                                        <li id="session_check_nav"><a href='/login/'> ç™»é™†</a></li>
                                </ul>
                        </div>
                </div>
        </div>
        <div class="content">
                <div class="content_box">
                        <div class='card'><p style='text-align: center;font-size: 25px;'><strong>ğŸ‘‡è¾“å…¥å…³é”®å­—æŸ¥è¯¢ğŸ‘‡</strong></p></div>
                        <div class='card' align="center">
                                <form class="form-inline mt-2 mt-md-0" style="width:40%;">
                                        <select class="form-control" id="search_key">
                                                <option value="nickname">æœç´¢ç”¨æˆ·</option>
                                                <option value="title">æœç´¢å¸–å­æ ‡é¢˜</option>
                                                <option value="content">æœç´¢å†…å®¹</option>
                                        </select>
                                        <input class="form-control" type="text" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®å­—ã€‚"
                                                id="search_value">
                                        <! -- åœ¨formä¸­æ·»åŠ buttonå¦‚æœä¸è®¾ç½®type='button' çš„è¯ä¼šæäº¤ä¸¤æ¬¡ï¼Œè°¨è®°ï¼ï¼è°¨è®°ï¼ï¼ -->
                                                <button class="btn btn-outline-success" id="searchBtn"
                                                        type="button">ç‚¹å‡»æŸ¥æ‰¾</button>
                                </form>
                        </div>
                        <div class="card">
                                <p id='search_ans_title'><strong>æœç´¢ç»“æœ:</strong></p>
                                <div id="search_ans">
                                        <! -- å±•ç¤ºç»“æœ -->
                                </div>
                        </div>
                </div>
        </div>
        <script>
                //è®¾ç½®session['post_id']
                set_session = function (post_id) {
                        data = {
                                'post_id': post_id
                        }
                        $.post('/set-session-postid/', data, function (ans) {
                                if (ans == "ok") {
                                        console.log("æ·»åŠ sessionæˆåŠŸ")
                                        window.location.replace("{{ url_for('comment',name='" + post_id + "')}}");
                                }
                                else {
                                        console.log("æ·»åŠ sessionå¤±è´¥ï¼")
                                        return false
                                }
                        })
                }

                //è·å–è¡¨å•ä¸­çš„æœç´¢ä¿¡æ¯
                get_search_key = function () {
                        key = $('#search_key option:selected').val()
                        value = $('#search_value').val()
                        if (value == '') {
                                alert('æœç´¢å…³é”®å­—ä¸èƒ½ä¸ºç©ºï¼')
                                return false
                        }
                        data = {
                                'key': key,
                                'value': value
                        }
                        //console.log(data)
                        $.post('/search-key/', data, function (ans) {
                                $('#search_ans').empty();
                                //console.log(ans)
                                if (ans == "empty") {
                                        alert("æœç´¢ç»“æœä¸ºç©ºï¼")
                                        return false
                                }
                                else {
                                        //alert("æ‰¾åˆ°æœç´¢ç»“æœï¼")
                                        all_lines = $.parseJSON(ans)
                                        var index;
                                        for (index in all_lines) {
                                                each_line = all_lines[index]
                                                //console.log(each_line)
                                                author_id = each_line[0]
                                                nickname = each_line[1]
                                                post_id = each_line[2]
                                                title = each_line[3]
                                                content = each_line[4]
                                                time = each_line[5]
                                                if (typeof title == "number") {
                                                        $('#search_ans').append("<div class='card'><a href='javascript:void(0);' onclick='set_session(" + post_id + ")'>"
                                                                + "<div style='padding:10px;background-color: #6fc2d0;'>"
                                                                + "<p style='font-size:15px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;'>" + content + "</p>"
                                                                + "<p style='text-align:right;'><small>" + nickname + "</small></p>"
                                                                + "<p style='text-align:right;'><small>" + time + "</small></p></div></a>"
                                                                + "</div>");
                                                }
                                                else {
                                                        $('#search_ans').append("<div class='card'><a href='javascript:void(0);' onclick='set_session(" + post_id + ")'>"
                                                                + "<div style='padding:10px;background-color: #a6acec;'>"
                                                                + "<p style='font-size:20px;'><strong>" + title + "</strong></p>"
                                                                + "<p style='font-size:15px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;'>" + content + "</p>"
                                                                + "<p style='text-align:right;'><small>" + nickname + "</small></p>"
                                                                + "<p style='text-align:right;'><small>" + time + "</small></p></div></a>"
                                                                + "</div>");
                                                }
                                        }
                                        //indexæ˜¯å­—ç¬¦ä¸²
                                        index=$.parseJSON(index)+1
                                        $('#search_ans_title').html('<strong>æœç´¢ç»“æœ: å…±è®¡'+index+'æ¡</strong>')
                                }
                        })
                }

                //å®šä¹‰ç‚¹å‡»æœç´¢æŒ‰é’®çš„è§¦å‘äº‹ä»¶
                $('#searchBtn').click(function () {
                        get_search_key()
                })

        </script>
        <div class="jumbotron text-center" style="margin-top:500px" id="footer">
                <p>å“ˆå°”æ»¨å·¥ç¨‹å¤§å­¦---æ•°æ®åº“è¯¾ç¨‹è®¾è®¡---2019</p>
        </div>
</body>

</html>